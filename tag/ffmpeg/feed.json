{
    "version": "https://jsonfeed.org/version/1",
    "title": "花咲く • All posts by \"ffmpeg\" tag",
    "description": "编程笔记 & 学渣的自救",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2022/05/29/FFmpeg%E4%B9%8B%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%8C%E6%AD%A5/",
            "url": "http://example.com/2022/05/29/FFmpeg%E4%B9%8B%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%8C%E6%AD%A5/",
            "title": "FFmpeg之音视频同步",
            "date_published": "2022-05-28T16:13:10.000Z",
            "content_html": "<p>音视频同步问题解释之前先需要了解几个基本的音视频的概念：</p>\n<ul>\n<li>pts  渲染时间戳（Presentation TimeStamp）</li>\n<li>dts 解码时间戳 （Decode TimeStamp）</li>\n<li>fps 每秒显示的帧数（Frame Per Second）：帧率</li>\n</ul>\n<h3 id=\"音频解码\"><a class=\"anchor\" href=\"#音频解码\">#</a> 音频解码</h3>\n<p>音频解码是顺序解码，所以音频的 PTS 和 DTS 是一样的，当前解码的帧就是当前需要显示的帧。</p>\n<h3 id=\"视频解码\"><a class=\"anchor\" href=\"#视频解码\">#</a> 视频解码</h3>\n<p>在视频解码中，由于采用了双向预测的帧间压缩技术，视频帧的解码顺序和视频帧的显示顺序就不一样了。<br />\n举个简单的例子：<br />\n有 1,2,3 这三张顺序显示的图片，第 1 张图片不依赖其他图片进行解码；第二张图片依赖第一张和第三张图片进行解码；第三张图片依赖第一张图片进行解码。</p>\n<p>如果按照 1-&gt;2-&gt;3 的顺序解码，那么由于 2 需要 1 和 3 进行解码，那么 2 就会解码失败。<br />\n所以为了成功的对 1,2,3 都进行解码，就应该按照下面的顺序进行解码：1-&gt;3-&gt;2, 这个顺序就是 dts 的顺序。</p>\n<h3 id=\"音视频同步问题\"><a class=\"anchor\" href=\"#音视频同步问题\">#</a> 音视频同步问题</h3>\n<h4 id=\"1音频播放速度异常\"><a class=\"anchor\" href=\"#1音频播放速度异常\">#</a> 1. 音频播放速度异常</h4>\n<p>可能原因：<br />\n1.1 音频播放器采样率参数设置错误<br />\n如果设置的采样率大于真实采用率，那么音频播放速度会比正常速度快；如果设置的采样率小于真实采样率，那么音频播放速度会比正常速度慢。</p>\n<p>1.2 音频解码速度太快，没有做同步，需要根据真实世界时钟速度进行同步解码</p>\n<h4 id=\"2视频播放速度异常\"><a class=\"anchor\" href=\"#2视频播放速度异常\">#</a> 2. 视频播放速度异常</h4>\n<p>可能原因：<br />\n2.1 视频解码速度太快，没有进行音视频同步或者音视频同步出错。</p>\n<h3 id=\"音视频同步策略\"><a class=\"anchor\" href=\"#音视频同步策略\">#</a> 音视频同步策略</h3>\n<p>音视频同步策略有三种：</p>\n<ul>\n<li>以视频 pts 为准进行同步</li>\n<li>以音频 pts 为基准进行同步</li>\n<li>以真实世界时钟速度进行同步</li>\n</ul>\n<p>常用第二种和第三种同步策略，为什么不使用第一种，是因为人的感观是对音频信号比视频画面更敏感，如果使用视频 pts 为基准的话，能感觉到明显的音频速度变化，而我们人眼对视频画面的变化是不敏感的，只要渲染的速度达到每秒 60 帧，对人的肉眼就看不出来停顿感。</p>\n",
            "tags": [
                "音视频",
                "FFmpeg"
            ]
        },
        {
            "id": "http://example.com/2022/04/15/ffmpeg%E5%85%A5%E9%97%A8-%E5%9C%A8Windows11%20%E4%B8%8B%E7%BC%96%E8%AF%91Android%E5%B9%B3%E5%8F%B0%E5%AF%B9%E5%BA%94SO/",
            "url": "http://example.com/2022/04/15/ffmpeg%E5%85%A5%E9%97%A8-%E5%9C%A8Windows11%20%E4%B8%8B%E7%BC%96%E8%AF%91Android%E5%B9%B3%E5%8F%B0%E5%AF%B9%E5%BA%94SO/",
            "title": "ffmpeg 的编译",
            "date_published": "2022-04-14T16:06:55.000Z",
            "content_html": "<p>编译参考了<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2F0Y2hpbmcudG9wLyMvYXJ0aWNsZS8xMDAwMDAxNTE4MzU3NzMw\">开发的猫</span> 这位同学的编译教程</p>\n<p>前置环境：<br />\n操作系统：windows 11<br />\nminGW：llvm-mingw-20220323-msvcrt-x86_64<br />\nmsys：msys2-x86_64-20220319.exe<br />\nndk：24.0.8215888<br />\nllvm：ndk 自带<br />\n clang： ndk 自带<br />\n yasm<br />\ngit</p>\n<p>msys 安装缺少工具：   <code>pacman -S &lt;pkgname&gt;</code></p>\n<p>编译工具链地址：C:\\Users\\ZhenqianXu\\AppData\\Local\\Android\\Sdk\\ndk\\24.0.8215888\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin<br />\n 交叉编译工具链地址：C:\\Users\\ZhenqianXu\\AppData\\Local\\Android\\Sdk\\ndk\\24.0.8215888\\toolchains\\llvm\\prebuilt\\windows-x86_64\\sysroot</p>\n<p>找到编译目标 Android 版本 29 需要的 clang 和 clang++ 文件<br />\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&quot;C:\\Users\\ZhenqianXu\\AppData\\Local\\Android\\Sdk\\ndk\\24.0.8215888\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\armv7a-linux-androideabi29-clang&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">&quot;C:\\Users\\ZhenqianXu\\AppData\\Local\\Android\\Sdk\\ndk\\24.0.8215888\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\armv7a-linux-androideabi29-clang++&quot;</span><br></pre></td></tr></table></figure><br />\n 进入 <code>configure</code>  文件中，找到 CMDLINE_SET，在其中添加一个变量<br />\n <code>cross-prefix-clang</code> <br />\n 然后就找到 <code>cc_default</code> , <code>cxx_default</code>  这两个变量定义的地方，修改为</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># clang set</span><br><span class=\"line\">cc_default=&quot;$&#123;cross_prefix_clang&#125;$&#123;cc_default&#125;&quot; cxx_default=&quot;$&#123;cross_prefix_clang&#125;$&#123;cxx_default&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 也可以直接改成下面的，这两个变量就是对应上面clang和clang++编译器路径</span><br><span class=\"line\">cc_default=&quot;$&#123;cross_prefix_clang&#125;clang&quot;</span><br><span class=\"line\">cxx_default=&quot;$&#123;cross_prefix_clang&#125;clang++&quot;</span><br></pre></td></tr></table></figure></p>\n<p>新建编译脚本：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">set -x</span><br><span class=\"line\"></span><br><span class=\"line\"># 目标Android版本</span><br><span class=\"line\"></span><br><span class=\"line\">API=29</span><br><span class=\"line\"></span><br><span class=\"line\">CPU=armv7-a</span><br><span class=\"line\"></span><br><span class=\"line\">#so库输出目录</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT=/c/Users/XZQ/Desktop/FFmpeg/ffmpeg-4.2.2/android/$CPU</span><br><span class=\"line\"></span><br><span class=\"line\"># NDK的路径，根据自己的NDK位置进行设置</span><br><span class=\"line\"></span><br><span class=\"line\">NDK=/c/Users/XZQ/AppData/Local/Android/Sdk/ndk/24.0.8215888</span><br><span class=\"line\"></span><br><span class=\"line\"># 编译工具链路径</span><br><span class=\"line\"></span><br><span class=\"line\">TOOLCHAIN=$NDK/toolchains/llvm/prebuilt/windows-x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"># 编译环境</span><br><span class=\"line\"></span><br><span class=\"line\">SYSROOT=$TOOLCHAIN/sysroot</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">function build</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ./configure \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --prefix=$OUTPUT \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --target-os=android \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --arch=arm \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --cpu=armv7-a \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --enable-asm \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --enable-neon \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --enable-cross-compile \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --enable-shared \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-static \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-doc \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-ffplay \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-ffprobe \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-symver \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --disable-ffmpeg \\</span><br><span class=\"line\">//禁掉strip优化，避免了找不到strip工具报错</span><br><span class=\"line\">  --disable-stripping \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --sysroot=$SYSROOT \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --cross-prefix-clang=$TOOLCHAIN/bin/armv7a-linux-androideabi$API- \\</span><br><span class=\"line\"></span><br><span class=\"line\">  --extra-cflags=&quot;-fPIC&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  make clean all</span><br><span class=\"line\"></span><br><span class=\"line\">  # 这里是定义用几个线程编译</span><br><span class=\"line\"></span><br><span class=\"line\">  make -j12</span><br><span class=\"line\"></span><br><span class=\"line\">  make install</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">build</span><br></pre></td></tr></table></figure></p>\n<p>在 msys 中运行该脚本：<br />\n <code>./build_android_clang.sh</code></p>\n<p>编译成功<br />\n<img data-src=\"http://tvax3.sinaimg.cn/large/b5348f57gy1h19rj5f737j20wg0dwafa.jpg\" alt=\"屏幕截图 2022-04-15 012650\" /></p>\n",
            "tags": [
                "多媒体",
                "ffmpeg"
            ]
        }
    ]
}