<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>花咲く • Posts by &#34;多媒体&#34; tag</title>
        <link>http://example.com</link>
        <description>编程笔记 &amp; 学渣的自救</description>
        <language>cn</language>
        <pubDate>Sun, 22 May 2022 23:20:23 +0800</pubDate>
        <lastBuildDate>Sun, 22 May 2022 23:20:23 +0800</lastBuildDate>
        <category>Android</category>
        <category>图像处理</category>
        <category>C++</category>
        <category>蓝牙</category>
        <category>系统</category>
        <category>Camera</category>
        <category>Cmake</category>
        <category>音视频</category>
        <category>FFmpeg</category>
        <category>多媒体</category>
        <category>ExoPlayer</category>
        <category>流媒体协议</category>
        <category>HLS</category>
        <category>算法</category>
        <category>LeetCode</category>
        <category>开发</category>
        <category>Mac</category>
        <category>OpenGL ES</category>
        <category>OpenGL ES2.0</category>
        <category>OpenGL ES3.0</category>
        <category>OpenSLES</category>
        <category>插件化</category>
        <category>Dalvik虚拟机</category>
        <category>leetcode</category>
        <category>ffmpeg</category>
        <category>日语</category>
        <category>歌词</category>
        <category>排序算法</category>
        <category>二叉树</category>
        <category>Algorithm</category>
        <category>数据结构</category>
        <category>树</category>
        <category>BFS</category>
        <item>
            <guid isPermalink="true">http://example.com/2022/05/22/OpenSLES%E7%AE%80%E4%BB%8B/</guid>
            <title>OpenSLES</title>
            <link>http://example.com/2022/05/22/OpenSLES%E7%AE%80%E4%BB%8B/</link>
            <category>Android</category>
            <category>多媒体</category>
            <category>OpenSLES</category>
            <pubDate>Sun, 22 May 2022 23:20:23 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;接受 pcm 原始音频脉冲数据&lt;/p&gt;
&lt;h2 id=&#34;简介&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#简介&#34;&gt;#&lt;/a&gt; 简介&lt;/h2&gt;
&lt;h3 id=&#34;object-sl对象&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#object-sl对象&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Object&lt;/code&gt;  SL 对象&lt;/h3&gt;
&lt;p&gt;代码中的 &lt;code&gt;SLObjectItf&lt;/code&gt;  类型，&lt;br /&gt;
每个对象都有三种状态：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unrelalized (initial state) : 不可用状态 ， 对接是活跃的，但是还没有分配资源，处于不可用状态，对象内接口的方法不能使用。&lt;/li&gt;
&lt;li&gt;Realized ：可用状态。对象资源已分配，可以使用对象&lt;/li&gt;
&lt;li&gt;Suspended (optional state): 挂起状态，所需资源比可用状态要少，但是在挂起期间保留了状态信息。当资源不足时，系统可以选择将对象状态改成挂起状态或是不可用状态&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;http://tvax2.sinaimg.cn/large/b5348f57gy1h2iqkwi4e2j20od0d2jsy.jpg&#34; alt=&#34;OpenSLES Object state diagram&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;interface-接口&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#interface-接口&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Interface&lt;/code&gt;  接口&lt;/h3&gt;
&lt;p&gt;由特定对象提供的相关特性集合的抽象，在代码中一般为 &lt;code&gt;SLxxxxItf&lt;/code&gt; . 接口必须由特定对象进行生成。&lt;/p&gt;
&lt;h3 id=&#34;一般使用方法&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#一般使用方法&#34;&gt;#&lt;/a&gt; 一般使用方法&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//声明对象和接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLObjectItf object = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLxxxxItf itf = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// init object创建对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// 初始化对象，分配资源&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(*object)-&amp;gt;Realize(object,SL_BOOLEAN_FALSE);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//check result&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// 初始化接口，第二个参数指定接口类型&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(*object)-&amp;gt;GetInterface(object,SL_IID_XXX,&amp;amp;itf);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//接口可以使用了&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;总结&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#总结&#34;&gt;#&lt;/a&gt; 总结&lt;/h3&gt;
&lt;p&gt;可以理解为一个对象代表了一个资源和状态，它内部有一系列的接口，对象本身不提供操作，而是由对象内部的接口提供方法调用。&lt;/p&gt;
&lt;h2 id=&#34;opensles使用流程&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#opensles使用流程&#34;&gt;#&lt;/a&gt; OpenSLES 使用流程：&lt;/h2&gt;
&lt;h3 id=&#34;环境配置&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#环境配置&#34;&gt;#&lt;/a&gt; 环境配置&lt;/h3&gt;
&lt;p&gt;Android 环境配置，在 CMakeLists 中将 OpenSLES 加入到目标库链接库列表中&lt;br /&gt;
 &lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CMakeLists.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_link_libraries(nativelib  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		....        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		OpenSLES  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        $&amp;#123;log-lib&amp;#125; )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;需要在头文件中加上引用&lt;br /&gt;
 &lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;opensles_player.h&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#include &amp;lt;SLES/OpenSLES.h&amp;gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#include &amp;lt;SLES/OpenSLES_Android.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;初始化&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#初始化&#34;&gt;#&lt;/a&gt; 初始化&lt;/h3&gt;
&lt;p&gt;先看一个图&lt;br /&gt;
&lt;img data-src=&#34;http://tva2.sinaimg.cn/large/b5348f57gy1h2iss734x0j20uc0ckq5i.jpg&#34; alt=&#34;OpenSLES audio flow diagram&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;1初始化引擎&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1初始化引擎&#34;&gt;#&lt;/a&gt; 1. 初始化引擎&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLObjectItf m_engine_obj = nullptr;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLEngineItf m_engine = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bool OpenSLRender::CreateEngine() &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLresult lresult =slCreateEngine(&amp;amp;m_engine_obj,0, nullptr,0, nullptr, nullptr);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult, &amp;quot;Engine&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_engine_obj)-&amp;gt;Realize(m_engine_obj,SL_BOOLEAN_FALSE);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;EngineRealize&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_engine_obj)-&amp;gt;GetInterface(m_engine_obj,SL_IID_ENGINE,&amp;amp;m_engine);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;GetInterface&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    return true;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;2初始化合成器&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2初始化合成器&#34;&gt;#&lt;/a&gt; 2. 初始化合成器&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;// 合成器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLObjectItf m_output_mix_obj = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// 环境混响接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLEnvironmentalReverbItf m_output_mix_evn_reverb = nullptr;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// 环境混响设置参数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLEnvironmentalReverbSettings m_output_mix_evn_settings = SL_I3DL2_ENVIRONMENT_PRESET_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bool OpenSLRender::CreateOutputMixer() &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    const SLInterfaceID mids[1] = &amp;#123;SL_IID_ENVIRONMENTALREVERB&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    const SLboolean mreq[1] = &amp;#123;SL_BOOLEAN_FALSE&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	//使用Engine接口创建合成器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLresult lresult = asInterface(m_engine)-&amp;gt;CreateOutputMix(m_engine,&amp;amp;m_output_mix_obj,1,mids,mreq);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Output Mix&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	//合成器对象初始化&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_output_mix_obj)-&amp;gt;Realize(m_output_mix_obj,SL_BOOLEAN_FALSE);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Mix Realize&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	//使用合成器对象获取环境混响接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_output_mix_obj)-&amp;gt;GetInterface(m_output_mix_obj,SL_IID_ENVIRONMENTALREVERB,&amp;amp;m_output_mix_evn_reverb);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Mix Env Reverb&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	//如果环境混响接口获取成功，设置环境混响属性为上面定义的默认值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(lresult == SL_RESULT_SUCCESS)&amp;#123;	  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        (*m_output_mix_evn_reverb)-&amp;gt;SetEnvironmentalReverbProperties(m_output_mix_evn_reverb,&amp;amp;m_output_mix_evn_settings);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    return true;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;3初始化并配置播放器对象&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#3初始化并配置播放器对象&#34;&gt;#&lt;/a&gt; 3. 初始化并配置播放器对象&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//播放器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLObjectItf m_pcm_player_obj = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//播放器接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLPlayItf m_pcm_player = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//音量接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLVolumeItf m_pcm_volume = nullptr;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// Android缓冲区队列接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SLAndroidSimpleBufferQueueItf m_pcm_buffer = nullptr;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bool OpenSLRender::ConfigPlayer() &amp;#123;          &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLDataLocator_AndroidSimpleBufferQueue android_queue =&amp;#123;SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE,SL_QUEUE_BUFFER_COUNT&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	// 定义PCM数据格式&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLDataFormat_PCM pcm = &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_DATAFORMAT_PCM,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(SLuint32)2,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_SAMPLINGRATE_44_1,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_PCMSAMPLEFORMAT_FIXED_16,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_PCMSAMPLEFORMAT_FIXED_16,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_SPEAKER_FRONT_LEFT|SL_SPEAKER_FRONT_RIGHT,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SL_BYTEORDER_LITTLEENDIAN  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLDataSource slDataSource =&amp;#123;&amp;amp;android_queue,&amp;amp;pcm&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLDataLocator_OutputMix outputMix = &amp;#123;SL_DATALOCATOR_OUTPUTMIX,m_output_mix_obj&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLDataSink dataSink = &amp;#123;&amp;amp;outputMix, nullptr&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLInterfaceID ids[3] = &amp;#123;SL_IID_BUFFERQUEUE,SL_IID_EFFECTSEND,SL_IID_VOLUME&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLboolean reqs[3] = &amp;#123;SL_BOOLEAN_TRUE,SL_BOOLEAN_TRUE,SL_BOOLEAN_TRUE,&amp;#125;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	// 通过Engine接口创建音频播放器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SLresult  lresult = asInterface(m_engine)-&amp;gt;CreateAudioPlayer(m_engine,&amp;amp;m_pcm_player_obj,&amp;amp;slDataSource,&amp;amp;dataSink,3,ids,reqs);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Create Audio Player&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	// 初始化音频播放器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_pcm_player_obj)-&amp;gt;Realize(m_pcm_player_obj,SL_BOOLEAN_FALSE);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Player Realize&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	// 使用音频播放器对象获取播放接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_pcm_player_obj)-&amp;gt;GetInterface(m_pcm_player_obj,SL_IID_PLAY,&amp;amp;m_pcm_player);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Player GetInterface&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	// 使用音频播放器对象获取缓冲区队列接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_pcm_player_obj)-&amp;gt;GetInterface(m_pcm_player_obj,SL_IID_BUFFERQUEUE,&amp;amp;m_pcm_buffer);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Buffer GetInterface&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	// 缓冲区队列注册缓冲区数据可用回调接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = (*m_pcm_buffer)-&amp;gt;RegisterCallback(m_pcm_buffer,sReadPcmBufferCbFun,this);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Buffer RegisterCallback&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  	// 使用音频播放器对象获取音量接口&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lresult = asInterface(m_pcm_player_obj)-&amp;gt;GetInterface(m_pcm_player_obj,SL_IID_VOLUME,&amp;amp;m_pcm_volume);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if(CheckError(lresult,&amp;quot;Player Volume  GetInterface&amp;quot;)) return false;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    LOGD(TAG,&amp;quot;OpenSL ES init success&amp;quot;);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    return true;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;播放&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#播放&#34;&gt;#&lt;/a&gt; 播放&lt;/h3&gt;
&lt;p&gt;创建一个播放线程，&lt;br /&gt;
解码器将解码数据 push 到 PCM 数据缓冲队列中，通知播放器线程启动播放&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;void createThread()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	std::thread t = std::thread(cb.render);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;void cb(OpenSLRender *render)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://example.com/2022/04/15/ffmpeg%E5%85%A5%E9%97%A8-%E5%9C%A8Windows11%20%E4%B8%8B%E7%BC%96%E8%AF%91Android%E5%B9%B3%E5%8F%B0%E5%AF%B9%E5%BA%94SO/</guid>
            <title>ffmpeg 的编译</title>
            <link>http://example.com/2022/04/15/ffmpeg%E5%85%A5%E9%97%A8-%E5%9C%A8Windows11%20%E4%B8%8B%E7%BC%96%E8%AF%91Android%E5%B9%B3%E5%8F%B0%E5%AF%B9%E5%BA%94SO/</link>
            <category>多媒体</category>
            <category>ffmpeg</category>
            <pubDate>Fri, 15 Apr 2022 00:06:55 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;编译参考了&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuY2F0Y2hpbmcudG9wLyMvYXJ0aWNsZS8xMDAwMDAxNTE4MzU3NzMw&#34;&gt;开发的猫&lt;/span&gt; 这位同学的编译教程&lt;/p&gt;
&lt;p&gt;前置环境：&lt;br /&gt;
操作系统：windows 11&lt;br /&gt;
minGW：llvm-mingw-20220323-msvcrt-x86_64&lt;br /&gt;
msys：msys2-x86_64-20220319.exe&lt;br /&gt;
ndk：24.0.8215888&lt;br /&gt;
llvm：ndk 自带&lt;br /&gt;
 clang： ndk 自带&lt;br /&gt;
 yasm&lt;br /&gt;
git&lt;/p&gt;
&lt;p&gt;msys 安装缺少工具：   &lt;code&gt;pacman -S &amp;lt;pkgname&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;编译工具链地址：C:\Users\ZhenqianXu\AppData\Local\Android\Sdk\ndk\24.0.8215888\toolchains\llvm\prebuilt\windows-x86_64\bin&lt;br /&gt;
 交叉编译工具链地址：C:\Users\ZhenqianXu\AppData\Local\Android\Sdk\ndk\24.0.8215888\toolchains\llvm\prebuilt\windows-x86_64\sysroot&lt;/p&gt;
&lt;p&gt;找到编译目标 Android 版本 29 需要的 clang 和 clang++ 文件&lt;br /&gt;
 &lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;C:\Users\ZhenqianXu\AppData\Local\Android\Sdk\ndk\24.0.8215888\toolchains\llvm\prebuilt\windows-x86_64\bin\armv7a-linux-androideabi29-clang&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;C:\Users\ZhenqianXu\AppData\Local\Android\Sdk\ndk\24.0.8215888\toolchains\llvm\prebuilt\windows-x86_64\bin\armv7a-linux-androideabi29-clang++&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br /&gt;
 进入 &lt;code&gt;configure&lt;/code&gt;  文件中，找到 CMDLINE_SET，在其中添加一个变量&lt;br /&gt;
 &lt;code&gt;cross-prefix-clang&lt;/code&gt; &lt;br /&gt;
 然后就找到 &lt;code&gt;cc_default&lt;/code&gt; , &lt;code&gt;cxx_default&lt;/code&gt;  这两个变量定义的地方，修改为&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# clang set&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cc_default=&amp;quot;$&amp;#123;cross_prefix_clang&amp;#125;$&amp;#123;cc_default&amp;#125;&amp;quot; cxx_default=&amp;quot;$&amp;#123;cross_prefix_clang&amp;#125;$&amp;#123;cxx_default&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 也可以直接改成下面的，这两个变量就是对应上面clang和clang++编译器路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cc_default=&amp;quot;$&amp;#123;cross_prefix_clang&amp;#125;clang&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cxx_default=&amp;quot;$&amp;#123;cross_prefix_clang&amp;#125;clang++&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;新建编译脚本：&lt;br /&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;set -x&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 目标Android版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;API=29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CPU=armv7-a&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#so库输出目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;OUTPUT=/c/Users/XZQ/Desktop/FFmpeg/ffmpeg-4.2.2/android/$CPU&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# NDK的路径，根据自己的NDK位置进行设置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;NDK=/c/Users/XZQ/AppData/Local/Android/Sdk/ndk/24.0.8215888&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 编译工具链路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TOOLCHAIN=$NDK/toolchains/llvm/prebuilt/windows-x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 编译环境&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SYSROOT=$TOOLCHAIN/sysroot&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;function build&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ./configure \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --prefix=$OUTPUT \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --target-os=android \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --arch=arm \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --cpu=armv7-a \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --enable-asm \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --enable-neon \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --enable-cross-compile \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --enable-shared \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-static \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-doc \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-ffplay \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-ffprobe \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-symver \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-ffmpeg \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//禁掉strip优化，避免了找不到strip工具报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --disable-stripping \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --sysroot=$SYSROOT \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --cross-prefix-clang=$TOOLCHAIN/bin/armv7a-linux-androideabi$API- \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --extra-cflags=&amp;quot;-fPIC&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  make clean all&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  # 这里是定义用几个线程编译&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  make -j12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  make install&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;build&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在 msys 中运行该脚本：&lt;br /&gt;
 &lt;code&gt;./build_android_clang.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;编译成功&lt;br /&gt;
&lt;img data-src=&#34;http://tvax3.sinaimg.cn/large/b5348f57gy1h19rj5f737j20wg0dwafa.jpg&#34; alt=&#34;屏幕截图 2022-04-15 012650&#34; /&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://example.com/2022/03/26/ExoPlayer-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%881%EF%BC%89/</guid>
            <title>ExoPlayer 源码解析（1）</title>
            <link>http://example.com/2022/03/26/ExoPlayer-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%881%EF%BC%89/</link>
            <category>Android</category>
            <category>多媒体</category>
            <category>ExoPlayer</category>
            <pubDate>Sat, 26 Mar 2022 18:52:40 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;start&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#start&#34;&gt;#&lt;/a&gt; Start&lt;/h1&gt;
&lt;h2 id=&#34;1exoplayer起播时序图&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1exoplayer起播时序图&#34;&gt;#&lt;/a&gt; 1.ExoPlayer 起播时序图&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tva1.sinaimg.cn/large/b5348f57gy1h0oaiq9lpej21e313iqpe.jpg&#34; alt=&#34;ExoPlayer播放.drawio&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;2exoplayer的初始化&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2exoplayer的初始化&#34;&gt;#&lt;/a&gt; 2.ExoPlayer 的初始化&lt;/h2&gt;
&lt;p&gt;先看看 ExoPlayer 的初始化&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;protected StyledPlayerView playerView;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;private DataSource.Factory dataSourceFactory;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;void onCreate(@Nullable Bundle savedInstanceState)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//创建&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	dataSourceFactory = DemoUtil.getDataSourceFactory(/* context= */ this);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	....&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//获取在XML中声明的StyledPlayerView对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	playerView = findViewById(R.id.player_view);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//初始化ExoPlayer&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;void initializePlayer()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//创建播放媒体列表对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	mediaItems = createMediaItems(intent);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//创建渲染器工厂对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	RenderersFactory renderersFactory =  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   DemoUtil.buildRenderersFactory(/* context= */ this, preferExtensionDecoders);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//创建媒体通道选择器对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	trackSelector = new DefaultTrackSelector(/* context= */ this);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//创建ExoPlayer对象&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player =  new ExoPlayer.Builder(/* context= */ this)  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       	.setRenderersFactory(renderersFactory)  //设置渲染器工厂对象  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       	.setMediaSourceFactory(createMediaSourceFactory())    //设置媒体源工厂对象  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       	.setTrackSelector(trackSelector)    //设置媒体通道选择器  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       	.build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player.setTrackSelectionParameters(trackSelectionParameters);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//设置播放器事件回调&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player.addListener(new PlayerEventListener());  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//设置音频参数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player.setAudioAttributes(AudioAttributes.DEFAULT, /* handleAudioFocus= */ true);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	//设置是否自动开始播放&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player.setPlayWhenReady(startAutoPlay);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	player.prepare();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上面就是 ExoPlayer 的播放代码，总结一下播放的流程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建 DataSource.Factory 工厂对象&lt;/li&gt;
&lt;li&gt;创建 StyledPlayerView 播放器 UI 对象&lt;/li&gt;
&lt;li&gt;创建 RenderersFactory 对象&lt;/li&gt;
&lt;li&gt;创建 MediaSource.Factory 对象&lt;/li&gt;
&lt;li&gt;创建 TrackSelector 对象&lt;/li&gt;
&lt;li&gt;通过 ExoPlayer.Builder 对象构造 ExoPlayer 对象&lt;/li&gt;
&lt;li&gt;添加播放器事件回调，设置默认音频参数&lt;/li&gt;
&lt;li&gt;设置是否自动开始播放&lt;/li&gt;
&lt;li&gt;开始起播&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;3重要的对象&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#3重要的对象&#34;&gt;#&lt;/a&gt; 3. 重要的对象&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;DataSource.Factory&lt;br /&gt;
DataSource.Factory 是负责创建 DataSource 对象的工厂类&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DataSource 代表 Uri 识别的数据源，根据不同的协议从不同媒体介质中获取视频数据流&lt;br /&gt;
下面是 ExoPlayer 实现了的数据源类型&lt;br /&gt;
&lt;img data-src=&#34;https://tvax3.sinaimg.cn/large/b5348f57gy1h0oajo70wvj20xz0pdb0a.jpg&#34; alt=&#34;DataSource实现类&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;StyledPlayerView&lt;br /&gt;
 播放器 UI 对象，包含了视频 UI，控制器 UI，字幕，专辑等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RenderersFactory&lt;br /&gt;
RenderersFactory 是负责创建 Renderer 的工厂对象。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Renderer 渲染器&lt;br /&gt;
 ExoPlayer 定义了 6 种 Renderer 对象：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;VideoRenderer    视频渲染器，负责视频渲染，实现类有 MediaCodecVideoRenderer，还有 ffmpeg 扩展&lt;/li&gt;
&lt;li&gt;AudioRenderer   音频渲染器&lt;/li&gt;
&lt;li&gt;TextRenderer  字幕渲染器&lt;/li&gt;
&lt;li&gt;MetadataRenderer  视频元数据渲染器&lt;/li&gt;
&lt;li&gt;CameraMotionRenderer  相机动作渲染器，CameraMotionRenderer 是处理相机拍摄的视频播放时，相机在物理上可能会有旋转动作，导致相机拍摄的视频也会产生 rotation，所以在播放相机拍摄的视频时需要解析视频中的 rotation 属性，然后在 OpenGL ES 渲染的时候，将窗口进行旋转，使画面恢复正常方向。&lt;/li&gt;
&lt;li&gt;MiscellaneousRenderer  混合渲染器 ，Google 暂时没有实现该渲染器，应该是留作扩展用。&lt;br /&gt;
&lt;img data-src=&#34;https://tvax4.sinaimg.cn/large/b5348f57gy1h0oak2u83fj20y80ieasz.jpg&#34; alt=&#34;Renderer实现类&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;p&gt;MediaSource.Factory&lt;br /&gt;
MediaSource.Factory 是负责构造 MediaSource 对象的工厂类&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MediaSource 媒体源，ExoPlayer 使用 MediaSource 实现了多视频播放逻辑，还有不停了流媒体协议类型等。&lt;br /&gt;
ExoPlayer 预定义的 MediaSource 类型：&lt;br /&gt;
&lt;img data-src=&#34;https://tva2.sinaimg.cn/large/b5348f57gy1h0oakcx1ssj20xi0exk6h.jpg&#34; alt=&#34;MediaSource实现类&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TrackSelector&lt;br /&gt;
 选择器：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;媒体流：用于在播放时选择容器中封装的的不同的视频、音频通道，比如在 HLS\DASH 流播放时根据网络带宽，设备性能选择不同分辨率的流。&lt;/li&gt;
&lt;li&gt;通道：播放时根据情况选择视频中不同的视频 \ 音频 \ 字幕通道。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;end&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#end&#34;&gt;#&lt;/a&gt; End&lt;/h1&gt;
&lt;p&gt;这里先粗略分析了一下 ExoPlayer 大致播放流程，还有部分的类的介绍，后面再根据情况对不同模块进行分析。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://example.com/2018/06/10/HLS%E7%9F%A5%E8%AF%86%E7%82%B9/</guid>
            <title>HLS知识点</title>
            <link>http://example.com/2018/06/10/HLS%E7%9F%A5%E8%AF%86%E7%82%B9/</link>
            <category>多媒体</category>
            <category>流媒体协议</category>
            <category>HLS</category>
            <pubDate>Sun, 10 Jun 2018 20:07:41 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;hls协议简介&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#hls协议简介&#34;&gt;#&lt;/a&gt; HLS 协议简介&lt;/h2&gt;
&lt;p&gt;全称 HTTP Live Streaming，是由苹果公司开发的用于支持在线音视频播放的流媒体协议，该协议是基于 HTTP 协议实现的。&lt;/p&gt;
&lt;p&gt;HLS 是由 m3u8 配置文件和 TS 分片文件组成的。&lt;/p&gt;
&lt;h2 id=&#34;m3u8&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#m3u8&#34;&gt;#&lt;/a&gt; m3u8&lt;/h2&gt;
&lt;p&gt;m3u8 是 m3u 文件的一种，是 HLS 定义的配置文件，客户端从该文件中解析出播放所需的元数据后，从中寻找可用的媒体流的地址，然后下载媒体流进行播放。&lt;/p&gt;
&lt;p&gt;m3u8 其实是一个播放列表文件 playlist，里面记录了可用的媒体片段信息，m3u8 文件支持嵌套。&lt;/p&gt;
&lt;p&gt;m3u8 文件结构：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EXTM3U    文件第一行配置指定这是一个 M3u8 文件&lt;/li&gt;
&lt;li&gt;EXT-X-MEDIA-SEQUENCE  第一个 TS 分片起始位置序号；直播时则为直播段起始位置&lt;/li&gt;
&lt;li&gt;EXT-X-TARGETDURATION 每个分片最大时长&lt;/li&gt;
&lt;li&gt;EXT-X-ALLOW-CACHE 是否运行缓存&lt;/li&gt;
&lt;li&gt;EXT-X-ENDLIST 文件结束符，如果是直播流，则没有文件结束符&lt;/li&gt;
&lt;li&gt;EXTINF 附加信息，分片的时长，带宽等&lt;/li&gt;
&lt;li&gt;EXT-X-VERSION m3u8 版本号&lt;/li&gt;
&lt;li&gt;EXT-X-DISCONTINUITY 分片中断&lt;/li&gt;
&lt;li&gt;EXT-X-PLAYLIST-TYPE 流媒体类型
&lt;ul&gt;
&lt;li&gt;类型： VOD  表明是点播源，文件中应该也有 ENDLIST 标签&lt;/li&gt;
&lt;li&gt;类型： EVENT   表明是直播源，文件中应该没有 ENDLIST 标签，不允许服务器修改已有的数据，但是可以在文件结尾添加新数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;EXT-X-KEY  是否加密解析&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;广告插入&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#广告插入&#34;&gt;#&lt;/a&gt; 广告插入&lt;/h3&gt;
&lt;p&gt;可以在 m3u8 中插入广告的 ts，实现广告的播放，但是有个问题是广告的视频编码格式与原视频可能不一样，所以需要在广告的 TS 分片前后加上 DISCONTINUITY 这个标签，表明视频前后中断，需要客户端去处理该情况。&lt;/p&gt;
&lt;h2 id=&#34;mpeg-2-transport-stream&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#mpeg-2-transport-stream&#34;&gt;#&lt;/a&gt; MPEG-2 Transport Stream&lt;/h2&gt;
&lt;p&gt;更有弹性避免包丢失和损坏&lt;/p&gt;
&lt;p&gt;ts 流的数据包固定大小为 188 字节，由 4 个字节的头和 184 字节组成，&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
